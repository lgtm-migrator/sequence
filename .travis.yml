# Travis CI Java documentation can be found in:
# https://docs.travis-ci.com/user/languages/java/

# We will use Ubuntu 18.04 (bionic beaver). List of options:
# https://docs.travis-ci.com/user/reference/overview/#linux
dist: xenial

# This enables the 'defaults' to test java applications:
language: java

# We can specify a list of JDKs to be used for testing
# A list of available JDKs in Trusty can be seed in:
# https://docs.travis-ci.com/user/reference/xenial/#jvm-clojure-groovy-java-scala-support
jdk:
 - openjdk8
 - openjdk11
 - openjdk14

cache:
  directories:
    - $HOME/.m2

# https://docs.travis-ci.com/user/job-lifecycle/
script:
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V -P '!aliyun-repo,!oss-release,travis-ci'
  - mvn test -DskipTests=false -B -P '!aliyun-repo,!oss-release,travis-ci'

# This is to enable CodeCov's coverage
# If a build is successful, the code is submitted for coverage analysis
# tip: export CODECOV_TOKEN="xxx"
after_success:
  - bash <(curl -Ls https://coverage.codacy.com/get.sh)

before_script:
  - git config --global core.autocrlf input

before_install:
  - mysql -e 'CREATE DATABASE IF NOT EXISTS test;'
  - psql -c 'create database test;' -U postgres

services:
  - mysql
  - mongodb
  - redis-server
  - postgresql

addons:
  postgresql: "9.6"
